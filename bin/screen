#!/bin/bash

LIBRARY_DIR=$1
START_MAT=$2
LIBRARY_SIZE=$3

if ((LIBRARY_SIZE < 10))
    then
        NUM_PROC=1
fi

if ((LIBRARY_SIZE >= 10))
    then
        NUM_PROC=$((LIBRARY_SIZE / 10))
fi

echo $NUM_PROC

export HTSOHM_DIR=${HOME}/HTSOHM-dev
export LIB_DIR=${HOME}/HTSOHM-dev/$LIBRARY_DIR
export RASPA_DIR=${HOME}/RASPA

#echo 'removing old .cif files and forcefields...'
#source $HTSOHM_DIR/bin/unload

cd $LIB_DIR
echo $PWD
cp $HTSOHM_DIR/bin/cpmat .
echo 'loading .cif files...'
source cpmat $LIBRARY_SIZE $START_MAT

cd $LIB_DIR
cp $HTSOHM_DIR/bin/mkforcefields .
echo 'loading forcefields...'
source mkforcefields $LIBRARY_SIZE $START_MAT

cd $HTSOHM_DIR/bin
echo 'submitting jobs ...'
source $HTSOHM_DIR/bin/qsub_master $START_MAT $LIBRARY_SIZE $NUM_PROC qsubCH4_noHVF
source $HTSOHM_DIR/bin/qsub_master $START_MAT $LIBRARY_SIZE $NUM_PROC qsubSA
source $HTSOHM_DIR/bin/qsub_master $START_MAT $LIBRARY_SIZE $NUM_PROC qsubHV

echo ' ... done!'
